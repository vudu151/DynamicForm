<!DOCTYPE html>
<html>
<head>
    <title>Mermaid Diagram 3</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body>
    <div class="mermaid">
sequenceDiagram
    participant Doctor
    participant WebApp
    participant API
    participant ValidationEngine
    participant DataService
    participant Database
    
    Doctor->>WebApp: Má»Ÿ form (code: PHIEU_KHAM)
    WebApp->>API: GET /api/forms/code/PHIEU_KHAM/metadata
    API->>Database: Load form metadata (version active)
    Database-->>API: Form + Fields + Validation
    API-->>WebApp: JSON metadata
    WebApp->>WebApp: Render form Ä‘á»™ng tá»« metadata
    WebApp-->>Doctor: Hiá»ƒn thá»‹ form
    
    Doctor->>Doctor: Nháº­p dá»¯ liá»‡u
    Doctor->>WebApp: Submit form
    
    WebApp->>WebApp: Validate client-side
    alt Client validation fail
        WebApp-->>Doctor: Hiá»ƒn thá»‹ lá»—i
    else Client validation pass
        WebApp->>API: POST /api/formdata
        API->>ValidationEngine: Validate server-side
        ValidationEngine-->>API: Validation result
        
        alt Server validation fail
            API-->>WebApp: 400 Bad Request + Errors
            WebApp-->>Doctor: Hiá»ƒn thá»‹ lá»—i chi tiáº¿t
        else Server validation pass
            API->>DataService: CreateFormData
            DataService->>Database: LÆ°u FORM_DATA
            Database-->>DataService: Success
            DataService-->>API: Created
            API-->>WebApp: 201 Created
            WebApp-->>Doctor: ThÃ nh cÃ´ng
        end
    end
    </div>
</body>
</html>
